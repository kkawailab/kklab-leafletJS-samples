<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15 - ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .description {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #map {
            height: 450px;
            width: 100%;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .controls {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .controls button {
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            border: 2px solid #007bff;
            border-radius: 5px;
            background: white;
            color: #007bff;
            transition: all 0.3s;
        }
        .controls button:hover {
            background: #007bff;
            color: white;
        }
        .controls button.active {
            background: #007bff;
            color: white;
        }
        .code-section {
            margin-top: 20px;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .code-section pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>15 - ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—</h1>
        <div class="description">
            <p><strong>å­¦ç¿’å†…å®¹:</strong> è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚</p>
            <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
            <ul>
                <li>L.layerGroup() ã§è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã¾ã¨ã‚ã‚‹</li>
                <li>L.featureGroup() ã¯å¢ƒç•Œè¨ˆç®—ãªã©ã®æ©Ÿèƒ½ã‚’è¿½åŠ </li>
                <li>ã‚°ãƒ«ãƒ¼ãƒ—å˜ä½ã§è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ</li>
                <li>addLayer() / removeLayer() ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ /å‰Šé™¤</li>
            </ul>
        </div>

        <div id="map"></div>

        <div class="controls">
            <button id="btnRestaurants" class="active" onclick="toggleLayer('restaurants')">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</button>
            <button id="btnHotels" class="active" onclick="toggleLayer('hotels')">ãƒ›ãƒ†ãƒ«</button>
            <button id="btnStations" class="active" onclick="toggleLayer('stations')">é§…</button>
            <button onclick="showAll()">ã™ã¹ã¦è¡¨ç¤º</button>
            <button onclick="hideAll()">ã™ã¹ã¦éè¡¨ç¤º</button>
            <button onclick="fitToRestaurants()">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã«ã‚ºãƒ¼ãƒ </button>
        </div>

        <div class="code-section">
            <pre>
// ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
const restaurantsGroup = L.layerGroup();
const hotelsGroup = L.layerGroup();

// ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
L.marker([35.68, 139.76]).addTo(restaurantsGroup);
L.marker([35.69, 139.77]).addTo(hotelsGroup);

// ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åœ°å›³ã«è¿½åŠ 
restaurantsGroup.addTo(map);
hotelsGroup.addTo(map);

// ã‚°ãƒ«ãƒ¼ãƒ—ã®è¡¨ç¤º/éè¡¨ç¤º
if (map.hasLayer(restaurantsGroup)) {
    map.removeLayer(restaurantsGroup);
} else {
    map.addLayer(restaurantsGroup);
}

// FeatureGroupã§å¢ƒç•Œã‚’å–å¾—
const featureGroup = L.featureGroup([marker1, marker2]);
map.fitBounds(featureGroup.getBounds());
            </pre>
        </div>
    </div>

    <!-- Leaflet.jsæœ¬ä½“ã‚’èª­ã¿è¾¼ã‚€ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ========================================
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚µãƒ³ãƒ—ãƒ«
        // è¤‡æ•°ã®ãƒãƒ¼ã‚«ãƒ¼ã‚„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã¾ã¨ã‚ã¦ç®¡ç†
        // ========================================

        // åœ°å›³ã‚’åˆæœŸåŒ–
        const map = L.map('map').setView([35.6812, 139.7671], 13);

        // ã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // ----------------------------------------
        // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã®ä½œæˆé–¢æ•°
        // ----------------------------------------
        function createIcon(emoji) {
            return L.divIcon({
                className: '',
                html: `<div style="font-size: 24px;">${emoji}</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15],
                popupAnchor: [0, -10]
            });
        }

        // ----------------------------------------
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
        // ----------------------------------------
        // L.layerGroup() - å˜ç´”ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã¾ã¨ã‚ã‚‹
        // L.featureGroup() - layerGroup + å¢ƒç•Œè¨ˆç®—ãªã©ã®æ©Ÿèƒ½
        // featureGroup ã¯ getBounds() ã§ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã®ç¯„å›²ã‚’å–å¾—ã§ãã‚‹
        const restaurantsGroup = L.featureGroup();
        const hotelsGroup = L.featureGroup();
        const stationsGroup = L.featureGroup();

        // ----------------------------------------
        // ãƒ‡ãƒ¼ã‚¿ã®å®šç¾©ã¨ãƒãƒ¼ã‚«ãƒ¼ã®è¿½åŠ 
        // ----------------------------------------
        // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ã§ç®¡ç†
        const restaurants = [
            { name: 'ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', lat: 35.6830, lng: 139.7700 },
            { name: 'å’Œé£Ÿãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', lat: 35.6780, lng: 139.7650 },
            { name: 'ãƒ•ãƒ¬ãƒ³ãƒãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', lat: 35.6850, lng: 139.7600 },
            { name: 'ä¸­è¯ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', lat: 35.6750, lng: 139.7720 }
        ];

        // ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
        // .addTo(restaurantsGroup) ã§åœ°å›³ã§ã¯ãªãã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
        restaurants.forEach(r => {
            L.marker([r.lat, r.lng], { icon: createIcon('ğŸœ') })
                .bindPopup(`<b>${r.name}</b>`)
                .addTo(restaurantsGroup);  // åœ°å›³ã§ã¯ãªãã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
        });

        // ãƒ›ãƒ†ãƒ«ãƒ‡ãƒ¼ã‚¿
        const hotels = [
            { name: 'ã‚°ãƒ©ãƒ³ãƒ‰ãƒ›ãƒ†ãƒ«', lat: 35.6870, lng: 139.7680 },
            { name: 'ãƒ“ã‚¸ãƒã‚¹ãƒ›ãƒ†ãƒ«', lat: 35.6800, lng: 139.7580 },
            { name: 'ã‚·ãƒ†ã‚£ãƒ›ãƒ†ãƒ«', lat: 35.6760, lng: 139.7750 }
        ];

        hotels.forEach(h => {
            L.marker([h.lat, h.lng], { icon: createIcon('ğŸ¨') })
                .bindPopup(`<b>${h.name}</b>`)
                .addTo(hotelsGroup);
        });

        // é§…ãƒ‡ãƒ¼ã‚¿
        const stations = [
            { name: 'æ±äº¬é§…', lat: 35.6812, lng: 139.7671 },
            { name: 'æœ‰æ¥½ç”ºé§…', lat: 35.6750, lng: 139.7630 },
            { name: 'ç¥ç”°é§…', lat: 35.6917, lng: 139.7703 }
        ];

        stations.forEach(s => {
            L.marker([s.lat, s.lng], { icon: createIcon('ğŸš‰') })
                .bindPopup(`<b>${s.name}</b>`)
                .addTo(stationsGroup);
        });

        // ----------------------------------------
        // ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åœ°å›³ã«è¿½åŠ 
        // ----------------------------------------
        // ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åœ°å›³ã«è¿½åŠ ã™ã‚‹ã¨ã€ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ã™ã¹ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        restaurantsGroup.addTo(map);
        hotelsGroup.addTo(map);
        stationsGroup.addTo(map);

        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç®¡ç†ç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆåå‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ï¼‰
        const layers = {
            restaurants: restaurantsGroup,
            hotels: hotelsGroup,
            stations: stationsGroup
        };

        // ----------------------------------------
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
        // ----------------------------------------
        function toggleLayer(name) {
            const layer = layers[name];
            const btn = document.getElementById('btn' + name.charAt(0).toUpperCase() + name.slice(1));

            // map.hasLayer() ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒåœ°å›³ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (map.hasLayer(layer)) {
                // map.removeLayer() ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‰Šé™¤ï¼ˆéè¡¨ç¤ºï¼‰
                map.removeLayer(layer);
                btn.classList.remove('active');
            } else {
                // map.addLayer() ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ï¼ˆè¡¨ç¤ºï¼‰
                map.addLayer(layer);
                btn.classList.add('active');
            }
        }

        // ã™ã¹ã¦è¡¨ç¤º
        function showAll() {
            Object.keys(layers).forEach(name => {
                if (!map.hasLayer(layers[name])) {
                    map.addLayer(layers[name]);
                }
                document.getElementById('btn' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');
            });
        }

        // ã™ã¹ã¦éè¡¨ç¤º
        function hideAll() {
            Object.keys(layers).forEach(name => {
                if (map.hasLayer(layers[name])) {
                    map.removeLayer(layers[name]);
                }
                document.getElementById('btn' + name.charAt(0).toUpperCase() + name.slice(1)).classList.remove('active');
            });
        }

        // ----------------------------------------
        // FeatureGroup ã®æ©Ÿèƒ½: getBounds()
        // ----------------------------------------
        // ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ã™ã¹ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’å«ã‚€ç¯„å›²ã‚’å–å¾—
        function fitToRestaurants() {
            if (map.hasLayer(restaurantsGroup)) {
                // getBounds() ã§ã‚°ãƒ«ãƒ¼ãƒ—ã®å¢ƒç•Œã‚’å–å¾—
                // pad(0.2) ã§ä½™ç™½ã‚’20%è¿½åŠ 
                map.fitBounds(restaurantsGroup.getBounds().pad(0.2));
            } else {
                alert('ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„');
            }
        }

        // ãƒ’ãƒ³ãƒˆ: LayerGroup ã¨ FeatureGroup ã®é•ã„
        // LayerGroup: å˜ç´”ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã¾ã¨ã‚ã‚‹
        // FeatureGroup: getBounds(), setStyle(), bindPopup() ãªã©ã®è¿½åŠ æ©Ÿèƒ½ã‚ã‚Š
    </script>
</body>
</html>
