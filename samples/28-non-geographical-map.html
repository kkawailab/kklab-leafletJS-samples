<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28 - éåœ°ç†çš„ãƒãƒƒãƒ—</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .description {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #map {
            height: 550px;
            width: 100%;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: #2d3e50;
        }
        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        .controls button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        .controls button:hover {
            background: #0056b3;
        }
        .code-section {
            margin-top: 20px;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .code-section pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>28 - éåœ°ç†çš„ãƒãƒƒãƒ—</h1>
        <div class="description">
            <p><strong>å­¦ç¿’å†…å®¹:</strong> Leafletã‚’ä½¿ã£ã¦åœ°å›³ä»¥å¤–ã®ã‚‚ã®ï¼ˆãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã€ã‚²ãƒ¼ãƒ ãƒãƒƒãƒ—ãªã©ï¼‰ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
            <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
            <ul>
                <li>L.CRS.Simple ã‚’ä½¿ç”¨ã—ã¦å˜ç´”ãªåº§æ¨™ç³»ã‚’åˆ©ç”¨</li>
                <li>ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§ã‚«ã‚¹ã‚¿ãƒ ç”»åƒã‚’è¡¨ç¤º</li>
                <li>ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§ãƒãƒ¼ã‚«ãƒ¼ã‚„ã‚·ã‚§ã‚¤ãƒ—ã‚’é…ç½®</li>
                <li>ç”¨é€”: ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã€ã‚²ãƒ¼ãƒ ãƒãƒƒãƒ—ã€åº§å¸­è¡¨ãªã©</li>
            </ul>
        </div>

        <div id="map"></div>

        <div class="controls">
            <button onclick="showFloor1()">1F</button>
            <button onclick="showFloor2()">2F</button>
            <button onclick="resetView()">å…¨ä½“è¡¨ç¤º</button>
        </div>

        <div class="code-section">
            <pre>
// å˜ç´”ãªåº§æ¨™ç³»ã‚’ä½¿ç”¨
const map = L.map('map', {
    crs: L.CRS.Simple,  // ç·¯åº¦çµŒåº¦ã§ã¯ãªããƒ”ã‚¯ã‚»ãƒ«åº§æ¨™
    minZoom: -2,
    maxZoom: 2
});

// ç”»åƒã®ç¯„å›²ï¼ˆãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ï¼‰
const bounds = [[0, 0], [1000, 1000]];

// ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
L.imageOverlay('floorplan.png', bounds).addTo(map);

// ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®
L.marker([500, 300]).addTo(map).bindPopup('ä¼šè­°å®¤A');

// ãƒ“ãƒ¥ãƒ¼ã‚’ç”»åƒã«ãƒ•ã‚£ãƒƒãƒˆ
map.fitBounds(bounds);
            </pre>
        </div>
    </div>

    <!-- Leaflet.jsæœ¬ä½“ã‚’èª­ã¿è¾¼ã‚€ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ========================================
        // éåœ°ç†çš„ãƒãƒƒãƒ—ã®ã‚µãƒ³ãƒ—ãƒ«
        // Leafletã‚’åœ°å›³ä»¥å¤–ã®ç”¨é€”ã§ä½¿ç”¨
        // ========================================
        // ç”¨é€”: ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã€ã‚²ãƒ¼ãƒ ãƒãƒƒãƒ—ã€åº§å¸­è¡¨ã€ç”»åƒãƒ“ãƒ¥ãƒ¼ã‚¢ãªã©

        // ----------------------------------------
        // åœ°å›³ã‚’åˆæœŸåŒ–ï¼ˆSimple CRSï¼‰
        // ----------------------------------------
        // L.CRS.Simple: ç·¯åº¦çµŒåº¦ã§ã¯ãªããƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã‚’ä½¿ç”¨
        // ç”»åƒã‚„ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒ—ã«æœ€é©
        const map = L.map('map', {
            crs: L.CRS.Simple,   // å˜ç´”ãªåº§æ¨™ç³»ï¼ˆãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ï¼‰
            minZoom: -1,         // ç¸®å°å¯èƒ½ï¼ˆ-1 = 50%ï¼‰
            maxZoom: 2           // æ‹¡å¤§å¯èƒ½ï¼ˆ2 = 400%ï¼‰
        });

        // ----------------------------------------
        // ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã®ã‚µã‚¤ã‚ºã¨å¢ƒç•Œ
        // ----------------------------------------
        const mapWidth = 800;    // ç”»åƒã®å¹…ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰
        const mapHeight = 600;   // ç”»åƒã®é«˜ã•ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰
        // bounds: [[y_min, x_min], [y_max, x_max]]
        const bounds = [[0, 0], [mapHeight, mapWidth]];

        // SVGã§ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆ
        const floorPlanSvg = `
            <svg xmlns="http://www.w3.org/2000/svg" width="${mapWidth}" height="${mapHeight}" viewBox="0 0 ${mapWidth} ${mapHeight}">
                <!-- èƒŒæ™¯ -->
                <rect width="100%" height="100%" fill="#f5f5f5"/>

                <!-- å¤–å£ -->
                <rect x="50" y="50" width="700" height="500" fill="none" stroke="#333" stroke-width="4"/>

                <!-- éƒ¨å±‹ã®åŒºåˆ‡ã‚Š -->
                <!-- ä¼šè­°å®¤A -->
                <rect x="50" y="50" width="200" height="200" fill="#e3f2fd" stroke="#333" stroke-width="2"/>
                <text x="150" y="150" text-anchor="middle" font-size="14" fill="#333">ä¼šè­°å®¤A</text>

                <!-- ä¼šè­°å®¤B -->
                <rect x="250" y="50" width="200" height="200" fill="#e8f5e9" stroke="#333" stroke-width="2"/>
                <text x="350" y="150" text-anchor="middle" font-size="14" fill="#333">ä¼šè­°å®¤B</text>

                <!-- ã‚ªãƒ•ã‚£ã‚¹ã‚¨ãƒªã‚¢ -->
                <rect x="50" y="250" width="400" height="300" fill="#fff3e0" stroke="#333" stroke-width="2"/>
                <text x="250" y="400" text-anchor="middle" font-size="16" fill="#333">ã‚ªãƒ•ã‚£ã‚¹ã‚¨ãƒªã‚¢</text>

                <!-- ä¼‘æ†©å®¤ -->
                <rect x="450" y="50" width="300" height="200" fill="#fce4ec" stroke="#333" stroke-width="2"/>
                <text x="600" y="150" text-anchor="middle" font-size="14" fill="#333">ä¼‘æ†©å®¤</text>

                <!-- ã‚µãƒ¼ãƒãƒ¼ãƒ«ãƒ¼ãƒ  -->
                <rect x="450" y="250" width="150" height="150" fill="#e0e0e0" stroke="#333" stroke-width="2"/>
                <text x="525" y="330" text-anchor="middle" font-size="12" fill="#333">ã‚µãƒ¼ãƒãƒ¼</text>

                <!-- ãƒˆã‚¤ãƒ¬ -->
                <rect x="600" y="250" width="150" height="150" fill="#e1f5fe" stroke="#333" stroke-width="2"/>
                <text x="675" y="330" text-anchor="middle" font-size="12" fill="#333">ãƒˆã‚¤ãƒ¬</text>

                <!-- å€‰åº« -->
                <rect x="450" y="400" width="300" height="150" fill="#efebe9" stroke="#333" stroke-width="2"/>
                <text x="600" y="480" text-anchor="middle" font-size="14" fill="#333">å€‰åº«</text>

                <!-- å…¥å£ -->
                <rect x="200" y="545" width="100" height="10" fill="#4caf50"/>
                <text x="250" y="540" text-anchor="middle" font-size="12" fill="#333">å…¥å£</text>

                <!-- ãƒ‡ã‚¹ã‚¯ã‚’é…ç½®ï¼ˆã‚ªãƒ•ã‚£ã‚¹ã‚¨ãƒªã‚¢å†…ï¼‰ -->
                <rect x="80" y="280" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="80" y="340" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="80" y="400" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="80" y="460" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>

                <rect x="180" y="280" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="180" y="340" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="180" y="400" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="180" y="460" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>

                <rect x="280" y="280" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="280" y="340" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="280" y="400" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="280" y="460" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>

                <rect x="380" y="280" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="380" y="340" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="380" y="400" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
                <rect x="380" y="460" width="60" height="40" fill="#fff" stroke="#666" stroke-width="1"/>
            </svg>
        `;

        // ----------------------------------------
        // SVGã‚’Data URLã«å¤‰æ›
        // ----------------------------------------
        // SVGæ–‡å­—åˆ—ã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦Data URLã«å¤‰æ›
        const svgDataUrl = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(floorPlanSvg)));

        // ----------------------------------------
        // ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¿½åŠ 
        // ----------------------------------------
        // L.imageOverlay(ç”»åƒURL, å¢ƒç•Œ) ã§ç”»åƒã‚’é…ç½®
        const floorPlan = L.imageOverlay(svgDataUrl, bounds).addTo(map);

        // fitBounds() ã§ç”»åƒå…¨ä½“ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãƒ“ãƒ¥ãƒ¼ã‚’èª¿æ•´
        map.fitBounds(bounds);

        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®ä½œæˆé–¢æ•°
        // ----------------------------------------
        function createIcon(emoji) {
            return L.divIcon({
                className: '',
                html: `<div style="font-size: 20px;">${emoji}</div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
        }

        // ----------------------------------------
        // è¨­å‚™ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®
        // ----------------------------------------
        // æ³¨æ„: Yåº§æ¨™ã®åè»¢ãŒå¿…è¦
        // SVGã®åŸç‚¹ã¯å·¦ä¸Šï¼ˆy=0ãŒä¸Šï¼‰ã€Leafletã¯å·¦ä¸‹ï¼ˆy=0ãŒä¸‹ï¼‰
        // ãã®ãŸã‚ã€yåº§æ¨™ã¯ (mapHeight - SVGã®yåº§æ¨™) ã§è¨ˆç®—
        const markers = [
            { pos: [mapHeight - 150, 150], name: 'ä¼šè­°å®¤A', icon: 'ğŸ“‹', info: 'å®šå“¡: 8å\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿ãƒ¼: ã‚ã‚Š' },
            { pos: [mapHeight - 150, 350], name: 'ä¼šè­°å®¤B', icon: 'ğŸ“‹', info: 'å®šå“¡: 6å\nãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰: ã‚ã‚Š' },
            { pos: [mapHeight - 150, 600], name: 'ä¼‘æ†©å®¤', icon: 'â˜•', info: 'ã‚³ãƒ¼ãƒ’ãƒ¼ãƒ¡ãƒ¼ã‚«ãƒ¼\nè‡ªè²©æ©Ÿã‚ã‚Š' },
            { pos: [mapHeight - 330, 525], name: 'ã‚µãƒ¼ãƒãƒ¼ãƒ«ãƒ¼ãƒ ', icon: 'ğŸ–¥ï¸', info: 'å…¥å®¤åˆ¶é™ã‚ã‚Š' },
            { pos: [mapHeight - 330, 675], name: 'ãƒˆã‚¤ãƒ¬', icon: 'ğŸš»', info: 'ç”·å¥³å…±ç”¨' },
            { pos: [mapHeight - 480, 600], name: 'å€‰åº«', icon: 'ğŸ“¦', info: 'å‚™å“ä¿ç®¡' },
            { pos: [mapHeight - 545, 250], name: 'å…¥å£', icon: 'ğŸšª', info: 'ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹' }
        ];

        // å„ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®
        // L.CRS.Simple ã§ã¯åº§æ¨™ã¯ [y, x] ã®é †
        markers.forEach(m => {
            L.marker(m.pos, { icon: createIcon(m.icon) })
                .addTo(map)
                .bindPopup(`<b>${m.name}</b><br><pre>${m.info}</pre>`);
        });

        // ----------------------------------------
        // ãƒ‡ã‚¹ã‚¯ã«ç•ªå·ã‚’ä»˜ã‘ã‚‹
        // ----------------------------------------
        const deskPositions = [];
        let deskNum = 1;
        for (let col = 0; col < 4; col++) {
            for (let row = 0; row < 4; row++) {
                const x = 110 + col * 100;
                const y = 300 + row * 60;
                deskPositions.push({
                    pos: [mapHeight - y, x],
                    num: deskNum++
                });
            }
        }

        deskPositions.forEach(desk => {
            const deskIcon = L.divIcon({
                className: '',
                html: `<div style="font-size: 10px; color: #666; text-align: center;">${desk.num}</div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            L.marker(desk.pos, { icon: deskIcon })
                .addTo(map)
                .bindPopup(`ãƒ‡ã‚¹ã‚¯ ${desk.num}`);
        });

        // ----------------------------------------
        // éšå±¤åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆãƒ‡ãƒ¢ï¼‰
        // ----------------------------------------
        // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯åˆ¥ã®ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
        function showFloor1() {
            alert('1Fã‚’è¡¨ç¤ºï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯åˆ¥ã®ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ç”»åƒã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼‰');
        }

        function showFloor2() {
            alert('2Fã‚’è¡¨ç¤ºï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯åˆ¥ã®ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ç”»åƒã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼‰');
        }

        function resetView() {
            // å…¨ä½“è¡¨ç¤ºã«æˆ»ã‚‹
            map.fitBounds(bounds);
        }

        // ----------------------------------------
        // ã‚¹ã‚±ãƒ¼ãƒ«è¡¨ç¤ºï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰
        // ----------------------------------------
        // L.CRS.Simple ã§ã¯é€šå¸¸ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯ä½¿ãˆãªã„
        const scaleControl = L.control({ position: 'bottomleft' });
        scaleControl.onAdd = function() {
            const div = L.DomUtil.create('div');
            div.style.cssText = 'background: white; padding: 5px 10px; border-radius: 3px; font-size: 12px;';
            div.innerHTML = '1ç›®ç››ã‚Š = 100px';
            return div;
        };
        scaleControl.addTo(map);

        // ãƒ’ãƒ³ãƒˆ: éåœ°ç†çš„ãƒãƒƒãƒ—ã®ãƒã‚¤ãƒ³ãƒˆ
        // 1. crs: L.CRS.Simple ã§ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã‚’ä½¿ç”¨
        // 2. L.imageOverlay() ã§ç”»åƒã‚’é…ç½®
        // 3. Yåº§æ¨™ã®åè»¢ã«æ³¨æ„ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¨ˆç®—ï¼‰
        // 4. ç”¨é€”: ãƒ•ãƒ­ã‚¢ãƒ—ãƒ©ãƒ³ã€ã‚²ãƒ¼ãƒ ãƒãƒƒãƒ—ã€åº§å¸­è¡¨ã€ç¾è¡“é¤¨ã‚¬ã‚¤ãƒ‰ãªã©
    </script>
</body>
</html>
