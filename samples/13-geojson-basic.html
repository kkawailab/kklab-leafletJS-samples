<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13 - GeoJSONの基本</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .description {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #map {
            height: 500px;
            width: 100%;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .code-section {
            margin-top: 20px;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .code-section pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>13 - GeoJSONの基本</h1>
        <div class="description">
            <p><strong>学習内容:</strong> GeoJSON形式のデータを地図上に表示します。</p>
            <p><strong>ポイント:</strong></p>
            <ul>
                <li>GeoJSONは地理データの標準フォーマット</li>
                <li>Point, LineString, Polygon などのジオメトリタイプ</li>
                <li>properties にメタデータを格納</li>
                <li>L.geoJSON() でGeoJSONを地図に追加</li>
            </ul>
            <p><strong>注意:</strong> GeoJSONの座標は <code>[経度, 緯度]</code> の順です。Leafletの <code>[緯度, 経度]</code> とは逆なので注意してください。</p>
        </div>

        <div id="map"></div>

        <div class="code-section">
            <pre>
// GeoJSONデータ
const geojsonData = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": { "name": "東京タワー" },
            "geometry": {
                "type": "Point",
                "coordinates": [139.7454, 35.6586]
            }
        },
        {
            "type": "Feature",
            "properties": { "name": "皇居周辺" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [[...]]
            }
        }
    ]
};

// GeoJSONレイヤーを追加
L.geoJSON(geojsonData).addTo(map);
            </pre>
        </div>
    </div>

    <!-- Leaflet.js本体を読み込む -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ========================================
        // GeoJSONの基本サンプル
        // GeoJSONは地理データの標準フォーマット
        // 多くのGISツールやAPIがGeoJSONをサポート
        // ========================================

        // 地図を初期化
        const map = L.map('map').setView([35.6700, 139.7500], 13);

        // タイルレイヤーを追加
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // ----------------------------------------
        // GeoJSONデータの構造
        // ----------------------------------------
        // GeoJSONは以下の構造を持つ:
        // - type: "FeatureCollection" (複数の地物を含むコレクション)
        // - features: 個々の地物（Feature）の配列
        // 各Featureは:
        // - type: "Feature"
        // - properties: メタデータ（名前、カテゴリなど任意のデータ）
        // - geometry: 地理情報（座標とタイプ）
        const geojsonData = {
            "type": "FeatureCollection",
            "features": [
                // Point（ポイント）- 東京タワー
                {
                    "type": "Feature",
                    "properties": {
                        "name": "東京タワー",
                        "type": "観光地",
                        "height": 333
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [139.7454, 35.6586]
                    }
                },
                // Point - スカイツリー
                {
                    "type": "Feature",
                    "properties": {
                        "name": "東京スカイツリー",
                        "type": "観光地",
                        "height": 634
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [139.8107, 35.7101]
                    }
                },
                // Point - 東京駅
                {
                    "type": "Feature",
                    "properties": {
                        "name": "東京駅",
                        "type": "駅"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [139.7671, 35.6812]
                    }
                },
                // LineString（線）- 隅田川（イメージ）
                {
                    "type": "Feature",
                    "properties": {
                        "name": "隅田川（イメージ）",
                        "type": "河川"
                    },
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                            [139.7900, 35.7200],
                            [139.7950, 35.7000],
                            [139.7850, 35.6800],
                            [139.7800, 35.6600]
                        ]
                    }
                },
                // Polygon（多角形）- 皇居周辺（イメージ）
                {
                    "type": "Feature",
                    "properties": {
                        "name": "皇居エリア（イメージ）",
                        "type": "公園"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [139.7500, 35.6900],
                            [139.7600, 35.6900],
                            [139.7650, 35.6850],
                            [139.7600, 35.6780],
                            [139.7500, 35.6780],
                            [139.7450, 35.6850],
                            [139.7500, 35.6900]
                        ]]
                    }
                },
                // MultiPoint（複数ポイント）
                {
                    "type": "Feature",
                    "properties": {
                        "name": "主要な公園",
                        "type": "公園群"
                    },
                    "geometry": {
                        "type": "MultiPoint",
                        "coordinates": [
                            [139.7030, 35.6762],  // 代々木公園
                            [139.7100, 35.6596]   // 明治神宮
                        ]
                    }
                }
            ]
        };

        // ----------------------------------------
        // L.geoJSON() でGeoJSONを地図に追加
        // ----------------------------------------
        // 第2引数のオプションで様々なカスタマイズが可能
        L.geoJSON(geojsonData, {
            // ----------------------------------------
            // onEachFeature: 各フィーチャーに対する処理
            // ----------------------------------------
            // feature: GeoJSONのフィーチャーデータ
            // layer: 作成されたLeafletレイヤー
            onEachFeature: function(feature, layer) {
                // properties にデータがあればポップアップを追加
                if (feature.properties) {
                    let content = `<b>${feature.properties.name}</b>`;
                    if (feature.properties.type) {
                        content += `<br>種類: ${feature.properties.type}`;
                    }
                    if (feature.properties.height) {
                        content += `<br>高さ: ${feature.properties.height}m`;
                    }
                    layer.bindPopup(content);
                }
            },

            // ----------------------------------------
            // pointToLayer: ポイントの表示方法を定義
            // ----------------------------------------
            // デフォルトはマーカー、CircleMarkerなどにも変更可能
            pointToLayer: function(feature, latlng) {
                return L.marker(latlng);
                // 円マーカーにする場合:
                // return L.circleMarker(latlng, { radius: 8 });
            },

            // ----------------------------------------
            // style: ラインとポリゴンのスタイルを定義
            // ----------------------------------------
            // フィーチャーごとに異なるスタイルを返すことができる
            style: function(feature) {
                // LineString（線）のスタイル
                if (feature.geometry.type === 'LineString') {
                    return {
                        color: '#0066cc',   // 線の色
                        weight: 4,          // 線の太さ
                        opacity: 0.7        // 不透明度
                    };
                }
                // Polygon（多角形）のスタイル
                if (feature.geometry.type === 'Polygon') {
                    return {
                        color: '#228B22',       // 線の色
                        fillColor: '#90EE90',   // 塗りつぶしの色
                        fillOpacity: 0.4,       // 塗りつぶしの透明度
                        weight: 2               // 線の太さ
                    };
                }
            }
        }).addTo(map);

        // ヒント: 外部のGeoJSONファイルを読み込む場合は fetch() を使う
        // fetch('data.geojson')
        //     .then(response => response.json())
        //     .then(data => L.geoJSON(data).addTo(map));
    </script>
</body>
</html>
