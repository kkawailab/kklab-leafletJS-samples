<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25 - å‹•çš„ãªãƒãƒ¼ã‚«ãƒ¼è¿½åŠ ãƒ»å‰Šé™¤</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .description {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .main-content {
            display: flex;
            gap: 20px;
        }
        #map {
            flex: 1;
            height: 550px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .sidebar {
            width: 300px;
        }
        .marker-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .marker-form h3 {
            margin-bottom: 10px;
        }
        .marker-form input, .marker-form select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .marker-form button {
            width: 100%;
            padding: 10px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .marker-form button:hover {
            background: #218838;
        }
        .marker-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        .marker-list h3 {
            margin-bottom: 10px;
        }
        .marker-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            margin-bottom: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .marker-item button {
            padding: 3px 8px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .marker-item button:hover {
            background: #c82333;
        }
        .marker-item .goto-btn {
            background: #007bff;
            margin-right: 5px;
        }
        .marker-item .goto-btn:hover {
            background: #0056b3;
        }
        .code-section {
            margin-top: 20px;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .code-section pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>25 - å‹•çš„ãªãƒãƒ¼ã‚«ãƒ¼è¿½åŠ ãƒ»å‰Šé™¤</h1>
        <div class="description">
            <p><strong>å­¦ç¿’å†…å®¹:</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚„ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ãƒãƒ¼ã‚«ãƒ¼ã‚’å‹•çš„ã«è¿½åŠ ãƒ»å‰Šé™¤ãƒ»æ›´æ–°ã—ã¾ã™ã€‚</p>
            <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
            <ul>
                <li>addTo() / remove() ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ãƒ»å‰Šé™¤</li>
                <li>setLatLng() ã§ä½ç½®ã‚’æ›´æ–°</li>
                <li>ãƒãƒ¼ã‚«ãƒ¼ã®å‚ç…§ã‚’é…åˆ—ã§ç®¡ç†</li>
                <li>åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ </li>
            </ul>
        </div>

        <div class="main-content">
            <div id="map"></div>
            <div class="sidebar">
                <div class="marker-form">
                    <h3>ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ </h3>
                    <input type="text" id="markerName" placeholder="åå‰">
                    <input type="number" id="markerLat" placeholder="ç·¯åº¦" step="0.0001" value="35.6812">
                    <input type="number" id="markerLng" placeholder="çµŒåº¦" step="0.0001" value="139.7671">
                    <select id="markerType">
                        <option value="default">é€šå¸¸ãƒãƒ¼ã‚«ãƒ¼</option>
                        <option value="restaurant">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ ğŸœ</option>
                        <option value="hotel">ãƒ›ãƒ†ãƒ« ğŸ¨</option>
                        <option value="station">é§… ğŸš‰</option>
                    </select>
                    <button onclick="addMarkerFromForm()">è¿½åŠ </button>
                </div>
                <div class="marker-list">
                    <h3>ãƒãƒ¼ã‚«ãƒ¼ä¸€è¦§ (<span id="markerCount">0</span>)</h3>
                    <div id="markerListItems"></div>
                </div>
            </div>
        </div>

        <div class="code-section">
            <pre>
// ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
function addMarker(name, lat, lng) {
    const marker = L.marker([lat, lng])
        .addTo(map)
        .bindPopup(name);

    markers.push({ id: Date.now(), name, marker });
    updateMarkerList();
}

// ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
function removeMarker(id) {
    const index = markers.findIndex(m => m.id === id);
    if (index !== -1) {
        markers[index].marker.remove();
        markers.splice(index, 1);
        updateMarkerList();
    }
}

// ãƒãƒ¼ã‚«ãƒ¼ä½ç½®ã‚’æ›´æ–°
marker.setLatLng([newLat, newLng]);
            </pre>
        </div>
    </div>

    <!-- Leaflet.jsæœ¬ä½“ã‚’èª­ã¿è¾¼ã‚€ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ========================================
        // å‹•çš„ãªãƒãƒ¼ã‚«ãƒ¼è¿½åŠ ãƒ»å‰Šé™¤ã®ã‚µãƒ³ãƒ—ãƒ«
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ãƒãƒ¼ã‚«ãƒ¼ã‚’ç®¡ç†ã™ã‚‹
        // ========================================

        // ----------------------------------------
        // åœ°å›³ã‚’åˆæœŸåŒ–
        // ----------------------------------------
        const map = L.map('map').setView([35.6812, 139.7671], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ç®¡ç†ç”¨ã®å¤‰æ•°
        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ã®å‚ç…§ã‚’é…åˆ—ã§ä¿æŒã™ã‚‹ã“ã¨ã§ã€å¾Œã‹ã‚‰æ“ä½œã§ãã‚‹
        let markers = [];   // ãƒãƒ¼ã‚«ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—
        let markerId = 0;   // ä¸€æ„ã®IDç”Ÿæˆç”¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼

        // ----------------------------------------
        // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã®å®šç¾©
        // ----------------------------------------
        // ç¨®é¡ã”ã¨ã«ç•°ãªã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”¨æ„
        const icons = {
            default: null,  // null = Leafletã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨
            restaurant: L.divIcon({
                className: '',
                html: '<div style="font-size: 24px;">ğŸœ</div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]  // ã‚¢ã‚¤ã‚³ãƒ³ã®ä¸­å¿ƒã‚’åŸºæº–ç‚¹ã«
            }),
            hotel: L.divIcon({
                className: '',
                html: '<div style="font-size: 24px;">ğŸ¨</div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            }),
            station: L.divIcon({
                className: '',
                html: '<div style="font-size: 24px;">ğŸš‰</div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            })
        };

        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
        // ----------------------------------------
        // addTo() ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã«è¿½åŠ 
        function addMarker(name, lat, lng, type = 'default') {
            const id = ++markerId;
            // ã‚¢ã‚¤ã‚³ãƒ³ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
            const options = icons[type] ? { icon: icons[type] } : {};

            // L.marker() ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
            // .addTo(map) ã§åœ°å›³ã«è¿½åŠ 
            // .bindPopup() ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ãƒã‚¤ãƒ³ãƒ‰
            const marker = L.marker([lat, lng], options)
                .addTo(map)
                .bindPopup(`<b>${name}</b><br>ç·¯åº¦: ${lat}<br>çµŒåº¦: ${lng}`);

            // ãƒãƒ¼ã‚«ãƒ¼ã®å‚ç…§ã‚’é…åˆ—ã«ä¿å­˜
            // å¾Œã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«IDã€åº§æ¨™ã€ãƒãƒ¼ã‚«ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿æŒ
            markers.push({
                id: id,
                name: name,
                lat: lat,
                lng: lng,
                type: type,
                marker: marker  // Leafletã®ãƒãƒ¼ã‚«ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            });

            // UIãƒªã‚¹ãƒˆã‚’æ›´æ–°
            updateMarkerList();
            return id;
        }

        // ----------------------------------------
        // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        // ----------------------------------------
        function addMarkerFromForm() {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å€¤ã‚’å–å¾—
            const name = document.getElementById('markerName').value || `ãƒãƒ¼ã‚«ãƒ¼ ${markerId + 1}`;
            const lat = parseFloat(document.getElementById('markerLat').value);
            const lng = parseFloat(document.getElementById('markerLng').value);
            const type = document.getElementById('markerType').value;

            // å…¥åŠ›æ¤œè¨¼
            if (isNaN(lat) || isNaN(lng)) {
                alert('ç·¯åº¦ãƒ»çµŒåº¦ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            addMarker(name, lat, lng, type);

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('markerName').value = '';
        }

        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
        // ----------------------------------------
        // remove() ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã‹ã‚‰å‰Šé™¤
        function removeMarker(id) {
            // é…åˆ—ã‹ã‚‰IDã«ä¸€è‡´ã™ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã‚’æ¤œç´¢
            const index = markers.findIndex(m => m.id === id);
            if (index !== -1) {
                // marker.remove() ã§åœ°å›³ã‹ã‚‰ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
                markers[index].marker.remove();
                // é…åˆ—ã‹ã‚‰ã‚‚å‰Šé™¤
                markers.splice(index, 1);
                updateMarkerList();
            }
        }

        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ã®ä½ç½®ã«ã‚ºãƒ¼ãƒ 
        // ----------------------------------------
        function gotoMarker(id) {
            const markerData = markers.find(m => m.id === id);
            if (markerData) {
                // setView() ã§åœ°å›³ã®ä¸­å¿ƒã¨ã‚ºãƒ¼ãƒ ã‚’å¤‰æ›´
                map.setView([markerData.lat, markerData.lng], 16);
                // openPopup() ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
                markerData.marker.openPopup();
            }
        }

        // ----------------------------------------
        // ãƒãƒ¼ã‚«ãƒ¼ãƒªã‚¹ãƒˆã®UIæ›´æ–°
        // ----------------------------------------
        function updateMarkerList() {
            const listElement = document.getElementById('markerListItems');
            // ãƒãƒ¼ã‚«ãƒ¼æ•°ã‚’è¡¨ç¤º
            document.getElementById('markerCount').textContent = markers.length;

            if (markers.length === 0) {
                listElement.innerHTML = '<p style="color: #666; font-size: 14px;">ãƒãƒ¼ã‚«ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            // å„ãƒãƒ¼ã‚«ãƒ¼ã®HTMLã‚’ç”Ÿæˆ
            // onclick ã§ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†ã‚’æŒ‡å®š
            listElement.innerHTML = markers.map(m => `
                <div class="marker-item">
                    <span>${m.name}</span>
                    <div>
                        <button class="goto-btn" onclick="gotoMarker(${m.id})">ç§»å‹•</button>
                        <button onclick="removeMarker(${m.id})">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // ----------------------------------------
        // åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        // ----------------------------------------
        // click ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã®åº§æ¨™ã‚’å–å¾—
        map.on('click', function(e) {
            // e.latlng ã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®ã®ç·¯åº¦çµŒåº¦ã‚’å–å¾—
            const lat = e.latlng.lat.toFixed(6);
            const lng = e.latlng.lng.toFixed(6);

            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åº§æ¨™ã‚’ã‚»ãƒƒãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¾¿å®œã®ãŸã‚ï¼‰
            document.getElementById('markerLat').value = lat;
            document.getElementById('markerLng').value = lng;

            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§è¿½åŠ ã™ã‚‹ã‹ã©ã†ã‹ç¢ºèª
            if (confirm(`ã“ã®ä½ç½®ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ\nç·¯åº¦: ${lat}\nçµŒåº¦: ${lng}`)) {
                const name = document.getElementById('markerName').value || `ãƒãƒ¼ã‚«ãƒ¼ ${markerId + 1}`;
                const type = document.getElementById('markerType').value;
                addMarker(name, parseFloat(lat), parseFloat(lng), type);
            }
        });

        // ----------------------------------------
        // åˆæœŸãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        // ----------------------------------------
        addMarker('æ±äº¬é§…', 35.6812, 139.7671, 'station');
        addMarker('æ–°å®¿é§…', 35.6896, 139.7006, 'station');
        addMarker('å’Œé£Ÿãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', 35.6850, 139.7600, 'restaurant');

        // åˆæœŸãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
        updateMarkerList();

        // ãƒ’ãƒ³ãƒˆ: ãƒãƒ¼ã‚«ãƒ¼ã®å‹•çš„æ“ä½œã¾ã¨ã‚
        // - marker.addTo(map): ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã«è¿½åŠ 
        // - marker.remove(): ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã‹ã‚‰å‰Šé™¤
        // - marker.setLatLng([lat, lng]): ãƒãƒ¼ã‚«ãƒ¼ã®ä½ç½®ã‚’å¤‰æ›´
        // - marker.setIcon(icon): ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰æ›´
        // - marker.openPopup() / closePopup(): ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®é–‹é–‰
        // - marker.getLatLng(): ç¾åœ¨ã®åº§æ¨™ã‚’å–å¾—
    </script>
</body>
</html>
